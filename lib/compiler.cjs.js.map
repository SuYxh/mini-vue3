{"version":3,"file":"compiler.cjs.js","sources":["../src/compiler-core/src/parse.ts"],"sourcesContent":["import { NodeTypes } from \"./ast\";\n\nconst enum TagType {\n  Start,\n  End,\n}\n\nexport function baseParse(content: string) {\n  const context = createParserContext(content);\n  return createRoot(parseChildren(context));\n}\n\nfunction parseChildren(context) {\n  const nodes: any = [];\n\n  let node;\n  const s = context.source;\n\n  if (s.startsWith(\"{{\")) {\n     node = parseInterpolation(context);\n  } else if (s[0] === \"<\") {\n    if (/[a-z]/i.test(s[1])) {\n      node = parseElement(context);\n    }\n  }\n\n  if (!node) {\n    node = parseText(context);\n  }\n\n  nodes.push(node);\n\n  return nodes;\n}\n\nfunction parseText(context: any) {\n  // 1. 获取content\n  const content = parseTextData(context, context.source.length);\n\n  return {\n    type: NodeTypes.TEXT,\n    content,\n  };\n}\n\nfunction parseTextData(context: any, length) {\n  const content = context.source.slice(0, length);\n\n  // 2. 推进\n  advanceBy(context, length);\n  return content;\n}\n\nfunction parseElement(context: any) {\n  const element = parseTag(context, TagType.Start);\n\n  parseTag(context, TagType.End);\n\n  return element;\n}\n\nfunction parseTag(context: any, type: TagType) {\n  // <div></div>\n  const match: any = /^<\\/?([a-z]*)/i.exec(context.source);\n  const tag = match[1];\n  advanceBy(context, match[0].length);\n  advanceBy(context, 1);\n\n  if (type === TagType.End) return;\n\n  return {\n    type: NodeTypes.ELEMENT,\n    tag,\n  };\n}\n\nfunction parseInterpolation(context) {\n  // {{message}}\n\n  const openDelimiter = \"{{\";\n  const closeDelimiter = \"}}\";\n\n  const closeIndex = context.source.indexOf(\n    closeDelimiter,\n    openDelimiter.length\n  );\n\n  advanceBy(context, openDelimiter.length);\n\n  const rawContentLength = closeIndex - openDelimiter.length;\n\n  const rawContent = parseTextData(context, rawContentLength);\n\n  const content = rawContent.trim();\n\n  advanceBy(context, closeDelimiter.length);\n\n  return {\n    type: NodeTypes.INTERPOLATION,\n    content: {\n      type: NodeTypes.SIMPLE_EXPRESSION,\n      content: content,\n    },\n  };\n}\n\nfunction advanceBy(context: any, length: number) {\n  context.source = context.source.slice(length);\n}\n\nfunction createRoot(children) {\n  return {\n    children,\n  };\n}\n\nfunction createParserContext(content: string): any {\n  return {\n    source: content,\n  };\n}\n"],"names":[],"mappings":"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"}